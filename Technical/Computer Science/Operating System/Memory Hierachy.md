---
categories: [os, computer-science]
title: Memory Hierachy
date created: 2023-05-30
date modified: 2023-07-10
tags: [os, computer-science]
---

B·ªô nh·ªõ l√† n∆°i m√† CPU c√≥ th·ªÉ truy c·∫≠p tr·ª±c ti·∫øp

ƒê·ªÉ m·ªôt ti·∫øn tr√¨nh ch·∫°y, ch∆∞∆°ng tr√¨nh ph·∫£i ƒë∆∞·ª£c n·∫°p v√†o b·ªô nh·ªõ.

M·ªôt kh√¥ng gian l∆∞u tr·ªØ ƒë·ªãa ch·ªâ v√† th√¥ng tin c·∫ßn thi·∫øt ƒë·ªÉ ch·∫°y ch∆∞∆°ng tr√¨nh v√† cung c·∫•p b·ªô nh·ªõ ƒë·ªÉ s·ª≠ d·ª•ng

## ƒê·∫∑c ƒëi·ªÉm c·ªßa b·ªô nh·ªõ

- Locality: Truy c·∫≠p d·ªØ li·ªáu g·∫ßn v·ªÅ th·ªùi gian ho·∫∑c kh√¥ng gian.
	- V·ªã tr√≠ t·∫°m th·ªùi (**Temporal locality**): N·∫øu m·ªôt s·ªë d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c truy c·∫≠p m·ªôt l·∫ßn, r·∫•t c√≥ kh·∫£ nƒÉng d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c truy c·∫≠p l·∫°i trong t∆∞∆°ng lai g·∫ßn.
	- V·ªã tr√≠ kh√¥ng gian (**Spatial locality**): X√°c su·∫•t m√† m·ªôt v·ªã tr√≠ b·ªô nh·ªõ li·ªÅn k·ªÅ v·ªõi v·ªã tr√≠ b·ªô nh·ªõ ƒë∆∞·ª£c truy c·∫≠p s·∫Ω ƒë∆∞·ª£c truy c·∫≠p l√† cao.
- N√≥ bao g·ªìm c√°c h·ªá th·ªëng ph√¢n c·∫•p s·ª≠ d·ª•ng nguy√™n t·∫Øc ƒë·ªãa ph∆∞∆°ng.
	- Khi b·∫°n ƒëi l√™n, th·ªùi gian truy c·∫≠p gi·∫£m, t·ªëc ƒë·ªô tƒÉng, chi ph√≠ tƒÉng v√† dung l∆∞·ª£ng gi·∫£m
- C√°c y·∫øu t·ªë quy·∫øt ƒë·ªãnh hi·ªáu su·∫•t: dung l∆∞·ª£ng b·ªô nh·ªõ (capacity), th·ªùi gian truy c·∫≠p (access time), th·ªùi gian chu k·ª≥ (cycle time), bƒÉng th√¥ng b·ªô nh·ªõ (bandwidth), chi ph√≠ (cost)

## 2. Memory layer = storage layer

‚úî M·ªôt c·∫•u tr√∫c x√°c ƒë·ªãnh s·ª± ƒë√°nh ƒë·ªïi gi·ªØa ba ƒë·∫∑c ƒëi·ªÉm ch√≠nh v·ªÅ dung l∆∞·ª£ng, t·ªëc ƒë·ªô truy c·∫≠p v√† chi ph√≠ v√† ƒëi·ªÅu ch·ªânh ch√∫ng khi c·∫ßn thi·∫øt.

![Pasted image 20230530012718](https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230530012718.png)

Theo m√¥ h√¨nh tr√™n:

- Dung l∆∞·ª£ng: c√†ng l√™n cao c√†ng nh·ªè
- T·ªëc ƒë·ªô truy c·∫≠p: c√†ng l√™n cao c√†ng nhanh
- Chi ph√≠: c√†ng l√™n cao c√†ng ƒë·∫Øt

L√Ω do ph√¢n c·∫•p:

- Chia b·ªô nh·ªõ th√†nh c√°c lo·∫°i kh√°c nhau khi c·∫ßn thi·∫øt cho ph√©p CPU truy c·∫≠p b·ªô nh·ªõ nhanh h∆°n.
- Hi·ªáu qu·∫£ t·ªëi ∆∞u c√≥ th·ªÉ ƒë·∫°t ƒë∆∞·ª£c b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c lo·∫°i thi·∫øt b·ªã l∆∞u tr·ªØ kh√°c nhau v·ªõi c√°c ƒë·∫∑c ƒëi·ªÉm ri√™ng c·ªßa ch√∫ng c√πng nhau.

### 1. Register üöë

- Register l∆∞u tr·ªØ d·ªØ li·ªáu c·∫ßn thi·∫øt ƒë·ªÉ CPU x·ª≠ l√Ω c√°c y√™u c·∫ßu
	- CPU kh√¥ng c√≥ c√°ch n√†o ƒë·ªÉ t·ª± l∆∞u tr·ªØ d·ªØ li·ªáu n√™n n√≥ kh√¥ng th·ªÉ chuy·ªÉn d·ªØ li·ªáu tr·ª±c ti·∫øp v√†o b·ªô nh·ªõ.
	- ‚Üí ƒê·ªÉ ho·∫°t ƒë·ªông, c√°c register ph·∫£i ƒë∆∞·ª£c th√¥ng qua v√† ƒë·ªëi v·ªõi ƒëi·ªÅu n√†y, c√°c register c√≥ th·ªÉ tr·ªè ƒë·∫øn c√°c ƒë·ªãa ch·ªâ c·ª• th·ªÉ ho·∫∑c ƒë·ªçc c√°c gi√° tr·ªã.
- Register l√† b·ªô nh·ªõ t·ªëc ƒë·ªô cao n·∫±m tr√™n b·ªô x·ª≠ l√Ω c√≥ ch·ª©a d·ªØ li·ªáu s·∫µn s√†ng cho qu√° tr√¨nh s·ª≠ d·ª•ng (m·ªôt l∆∞·ª£ng nh·ªè d·ªØ li·ªáu, k·∫øt qu·∫£ trung gian ƒëang ƒë∆∞·ª£c x·ª≠ l√Ω, v.v.)

#### CPU Internal Register Type

|Ki·ªÉu|√ù nghƒ©a|
|---|---|
|PC (Program Counter)|Ch·ª©a ƒë·ªãa ch·ªâ c·ªßa l·ªánh (instruction) ti·∫øp theo s·∫Ω ƒë∆∞·ª£c th·ª±c hi·ªán|
|AC (ACcumulator)|L∆∞u tr·ªØ t·∫°m th·ªùi d·ªØ li·ªáu k·∫øt qu·∫£ ho·∫°t ƒë·ªông|
|IR (Instruction Register)|L∆∞u l·ªánh hi·ªán ƒëang th·ª±c hi·ªán|
|SR (Status Register)|L∆∞u tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa CPU|
|MAR (Memory Address Register)|Ch·ª©a c√°c ƒë·ªãa ch·ªâ ƒë·ªÉ ƒë·ªçc ho·∫∑c ghi v√†o b·ªô nh·ªõ|
|MBR (Memory Buffer Register)|L∆∞u d·ªØ li·ªáu ƒë·ªçc t·ª´ b·ªô nh·ªõ ho·∫∑c d·ªØ li·ªáu ƒë∆∞·ª£c ghi v√†o b·ªô nh·ªõ|
|I/O AR (I/O Address Register)|L∆∞u ƒë·ªãa ch·ªâ c·ªßa I/O Module theo I/O Device|
|I/O BR (I/O Buffer Register)|ƒê∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ trao ƒë·ªïi d·ªØ li·ªáu gi·ªØa I/O Module v√† CPU|

### 2. Cache¬†üöó

L√† n∆°i d·ªØ li·ªáu ho·∫∑c gi√° tr·ªã ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng v√† c√≥ kh·∫£ nƒÉng ƒë∆∞·ª£c s·ª≠ d·ª•ng l·∫°i.

![Pasted image 20230530015334](https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230530015334.png)

- M·ª•c ƒë√≠ch c·∫£i thi·ªán s·ª± kh√°c bi·ªát v·ªÅ t·ªëc ƒë·ªô gi·ªØa CPU v√† b·ªô nh·ªõ ch√≠nh
- ƒê∆∞·ª£c s·ª≠ d·ª•ng cho hi·ªáu qu·∫£ h·ªá th·ªëng:
	- N·∫øu m·∫•t nhi·ªÅu th·ªùi gian ƒë·ªÉ truy c·∫≠p d·ªØ li·ªáu g·ªëc so v·ªõi th·ªùi gian truy c·∫≠p b·ªô ƒë·ªám  
	- N·∫øu b·∫°n mu·ªën ti·∫øt ki·ªám th·ªùi gian t√≠nh to√°n l·∫°i c√°c gi√° tr·ªã  
- B·ªô nh·ªõ ƒëa nƒÉng ƒë·ªÉ gi·∫£m b·ªõt t·∫Øc ngh·∫Ωn ch√™nh l·ªách t·ªëc ƒë·ªô gi·ªØa c√°c thi·∫øt b·ªã nhanh v√† ch·∫≠m

#### CPU Cache

- B·ªô nh·ªõ cache ƒë∆∞·ª£c g·∫Øn b√™n trong ho·∫∑c b√™n c·∫°nh chip CPU ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô truy c·∫≠p v√†o l∆∞·ª£ng l·ªõn b·ªô nh·ªõ ch√≠nh.
- Qu·∫£n l√Ω th√¥ng qua ph·∫ßn c·ª©ng
- Trong CPU hi·ªán ƒë·∫°i th∆∞·ªùng c√≥ 3 level cache: L1, L2, L3

![cpu-cache-work](https://raw.githubusercontent.com/vanhung4499/images/master/snap/cpu-cache-work.svg)

#### Disk Cache

- B·ªô nh·ªõ cache ƒë∆∞·ª£c t√≠ch h·ª£p trong ƒëƒ©a c·ª©ng (ch·ª©c nƒÉng: ƒëi·ªÅu khi·ªÉn ƒëƒ©a, giao ti·∫øp v·ªõi b√™n ngo√†i) (b·ªô nh·ªõ nh·ªè l∆∞u d·ªØ li·ªáu v√†o v√† ra ƒëƒ©a)
- L√† lo·∫°i k·ªπ thu·∫≠t t·ªìn t·∫°i ƒë·ªÉ gi·∫£m chi ph√≠ trao ƒë·ªïi d·ªØ li·ªáu gi·ªØa Disk v√† RAM

#### Other Cache

- Cache ƒë∆∞·ª£c qu·∫£n l√Ω b·∫±ng ph·∫ßn m·ªÅm
- Page Cache: Sao ch√©p b·ªô nh·ªõ ch√≠nh c·ªßa h·ªá ƒëi·ªÅu h√†nh v√†o ƒëƒ©a c·ª©ng, vd: web cache

**ƒê·ªÉ Cache ho·∫°t ƒë·ªông hi·ªáu qu·∫£, d·ªØ li·ªáu m√† n√≥ l∆∞u tr·ªØ ph·∫£i l√† c·ª•c b·ªô.**

### 3. Main Memory üõµ

- L√† b·ªô nh·ªõ ch√≠nh c·ªßa m√°y t√≠nh
- L√† thi·∫øt b·ªã ph·∫ßn c·ª©ng m√°y t√≠nh l∆∞u tr·ªØ c√°c gi√° tr·ªã s·ªë, l·ªánh, d·ªØ li·ªáu, v.v. trong m√°y t√≠nh
- **RAM(Random Access Memory)**: L∆∞u tr·ªØ ng·∫Øn h·∫°n
	- Th√†nh ph·∫ßn l∆∞u tr·ªØ d·ªØ li·ªáu trong m·ªôt kho·∫£ng th·ªùi gian ng·∫Øn ƒë·ªÉ truy c·∫≠p nhanh
	- Truy c·∫≠p th√¥ng tin t∆∞∆°ng ·ª©ng b·∫±ng c√°ch t·∫£i ch∆∞∆°ng tr√¨nh ho·∫∑c t√†i nguy√™n do ng∆∞·ªùi d√πng y√™u c·∫ßu t·ª´ ƒëƒ©a l∆∞u tr·ªØ v√†o b·ªô nh·ªõ
	- Khi ngu·ªìn ƒëi·ªán ƒë∆∞·ª£c duy tr√¨, m·ªçi th·ª© c·∫ßn thi·∫øt cho ho·∫°t ƒë·ªông v√† v·∫≠n h√†nh c·ªßa CPU ƒë·ªÅu ƒë∆∞·ª£c l∆∞u tr·ªØ.
	- X√≥a s·∫°ch d·ªØ li·ªáu khi t·∫Øt ngu·ªìn
	- `Random Access`: C√≥ nghƒ©a l√† b·∫°n c√≥ th·ªÉ truy c·∫≠p, ƒë·ªçc v√† ghi ·ªü c√πng m·ªôt t·ªëc ƒë·ªô t·ª´ b·∫•t k·ª≥ v·ªã tr√≠ n√†o.
	- C√≥ **DRAM** v√† **SRAM**, v√† b·ªô nh·ªõ ch√≠nh ch·ªß y·∫øu c√≥ nghƒ©a l√† DRAM. (SRAM cache ho·∫∑c register)
- **ROM(Read Only Memory)**¬†:¬†L∆∞u tr≈© vƒ©nh vi·ªÖn
	- B·ªô nh·ªõ c·ªë ƒë·ªãnh l∆∞u tr·ªØ vƒ©nh vi·ªÖn c√°c instruction trong m√°y t√≠nh  
	- Gi·ªØ l·∫°i n·ªôi dung ƒë√£ ghi nh·ªõ khi t·∫Øt ngu·ªìn  
	- ƒê∆∞·ª£c s·ª≠ d·ª•ng cho c√°c t√≠nh nƒÉng v√† b·ªô ph·∫≠n kh√¥ng c√≥ kh·∫£ nƒÉng thay ƒë·ªïi  
		- Ph·∫ßn m·ªÅm: Ph·∫ßn li√™n quan ƒë·∫øn BOOTING
		- Ph·∫ßn c·ª©ng: C√°c l·ªánh firmware li√™n quan ƒë·∫øn ho·∫°t ƒë·ªông c·ªßa m√°y in, v.v.  
	- Thay v√¨ ƒë∆∞·ª£c s·ª≠ d·ª•ng l√†m b·ªô nh·ªõ ch√≠nh, ROM ch·ªß y·∫øu ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l∆∞u tr·ªØ ph·∫ßn m·ªÅm h·ªá th·ªëng kh√¥ng c√≥ kh·∫£ nƒÉng thay ƒë·ªïi, ch·∫≥ng h·∫°n nh∆∞ Basic Input Output System (BIOS).

> üôã‚Äç‚ôÄÔ∏è DRAM v√† SRAM l√† g√¨?
>
> DRAM - Dynamic RAM
> - b·ªô nh·ªõ ƒë·ªông  
> - Ngay c·∫£ khi ngu·ªìn ƒëi·ªán ƒë∆∞·ª£c cung c·∫•p li√™n t·ª•c, n√≥ v·∫´n ph·∫£i ƒë∆∞·ª£c s·∫°c l·∫°i ƒë·ªãnh k·ª≥ ƒë·ªÉ duy tr√¨ n·ªôi dung ƒë√£ ghi nh·ªõ.
> - N√≥ ch·ªß y·∫øu ƒë∆∞·ª£c s·ª≠ d·ª•ng cho c√°c thi·∫øt b·ªã l∆∞u tr·ªØ dung l∆∞·ª£ng l·ªõn v√† kh√¥ng t·ªën k√©m.
> - Ch·ªß y·∫øu ƒë∆∞·ª£c th·ªÉ hi·ªán d∆∞·ªõi d·∫°ng RAM (b·ªô nh·ªõ ch√≠nh) g·∫ßn nh∆∞ l√† DRAM.  
>
> SRAM - Static RAM
> - B·ªô nh·ªõ tƒ©nh  
> - Mi·ªÖn l√† ngu·ªìn ƒëi·ªán ƒë∆∞·ª£c cung c·∫•p, n·ªôi dung ƒë∆∞·ª£c ghi s·∫Ω kh√¥ng b·ªã x√≥a, do ƒë√≥ kh√¥ng c·∫ßn ph·∫£i s·∫°c l·∫°i.  
> - ƒê·∫∑c tr∆∞ng l√† t·ªëc ƒë·ªô truy c·∫≠p cao v√† gi√° cao, v√† ch·ªß y·∫øu ƒë∆∞·ª£c s·ª≠ d·ª•ng l√†m cache ho·∫∑c register.

### 4. Secondary Memory¬†üö≤

- L√† thi·∫øt b·ªã l∆∞u tr·ªØ ·ª©ng v·ªõi physical disk
- **HDD(Hard Disk Drive), SSD(Solid State Drive)**
- D·ªØ li·ªáu ƒë√£ l∆∞u kh√¥ng m·∫•t khi t·∫Øt m√°y t√≠nh (non-volatile)
- Kh√¥ng th·ªÉ trao ƒë·ªïi d·ªØ li·ªáu tr·ª±c ti·∫øp v·ªõi CPU  
- Truy c·∫≠p m·∫•t nhi·ªÅu th·ªùi gian  
- N√≥i chung, ph∆∞∆°ng ph√°p DMA ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu trong b·ªô nh·ªõ ch√≠nh.  
- Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p CPU tr·ª±c ti·∫øp  

> Main Memory so v·ªõi Secondary Memory
>
> Memory hay Main Memory, c√≥ th·ªÉ ƒë∆∞·ª£c truy c·∫≠p tr·ª±c ti·∫øp b·ªüi CPU, nh∆∞ng disk hay Secondary Memory, d·ªØ li·ªáu ph·∫£i ƒë∆∞·ª£c n·∫°p v√†o Main Memory tr∆∞·ªõc khi CPU c√≥ th·ªÉ s·ª≠ d·ª•ng.
>
> - CPU: b·ªô n√£o con ng∆∞·ªùi
> - Memory: kh√¥ng gian d√†nh cho c√¥ng vi·ªác (v√≠ d·ª•: b√†n, notepad): kh√¥ng gian ƒë·ªÉ CPU x·ª≠ l√Ω th·ª© g√¨ ƒë√≥
> - Disk: kh√¥ng gian ƒë·ªÉ l∆∞u tr·ªØ (v√≠ d·ª•: gi√° s√°ch, s·∫Øp x·∫øp ghi ch√∫)

## S·ª± c·∫ßn thi·∫øt c·ªßa vi·ªác ph√¢n c·∫•p b·ªô nh·ªõ

### 1. T·ªëc ƒë·ªô gi·∫£i m√£ (decode instruction)

- **Decoding**: C√≤n ƒë∆∞·ª£c g·ªçi l√† gi·∫£i m√£, qu√° tr√¨nh tr·∫£ l·∫°i th√¥ng tin ƒë∆∞·ª£c m√£ h√≥a v·ªÅ tr·∫°ng th√°i tr∆∞·ªõc khi n√≥ ƒë∆∞·ª£c m√£ h√≥a ho·∫∑c ph∆∞∆°ng ph√°p x·ª≠ l√Ω c·ªßa n√≥  
- CPU truy c·∫≠p b·ªô nh·ªõ th√¥ng qua ba bus  
	- Address Bus: Cho bi·∫øt CPU s·∫Ω truy c·∫≠p d·ªØ li·ªáu t·ª´ ph·∫ßn n√†o c·ªßa b·ªô nh·ªõ  
	- Data Bus: truy·ªÅn d·ªØ li·ªáu gi·ªØa b·ªô nh·ªõ v√† CPU  
	- Control Bus: Truy·ªÅn t√≠n hi·ªáu ƒëi·ªÅu khi·ªÉn, ch·ªâ b√°o truy c·∫≠p b·ªô nh·ªõ CPU  
- Khi c√°c gi√° tr·ªã hi·ªán di·ªán tr√™n address bus v√† data bus, CPU s·∫Ω th·ª±c hi·ªán c√°c t√°c v·ª• b·ªô nh·ªõ ngay khi n√≥ g·ª≠i t√≠n hi·ªáu ƒëi·ªÅu khi·ªÉn.  
- Gi·∫£i m√£ v√† truy·ªÅn t√≠n hi·ªáu ƒëi·ªÅu khi·ªÉn v√†o m·ªôt b·ªô nh·ªõ, m·∫•t nhi·ªÅu th·ªùi gian h∆°n ƒë·ªÉ gi·∫£i m√£ khi s·ª≠ d·ª•ng dung l∆∞·ª£ng b·ªô nh·ªõ l·ªõn

![os-memory-decode](https://raw.githubusercontent.com/vanhung4499/images/master/snap/os-memory-decode.svg)

‚Üí ƒê·ªÉ CPU truy c·∫≠p d·ªØ li·ªáu nhanh th√¨ b·ªô nh·ªõ l∆∞u d·ªØ li·ªáu ph·∫£i nh·ªè.  

### 2. D·ªØ li·ªáu ƒë∆∞·ª£c s·ª≠ d·ª•ng th∆∞·ªùng xuy√™n

- Ngay c·∫£ khi s·ª≠ d·ª•ng m·ªôt l∆∞·ª£ng l·ªõn b·ªô nh·ªõ, t·∫•t c·∫£ d·ªØ li·ªáu trong ƒë√≥ kh√¥ng ƒë∆∞·ª£c truy c·∫≠p ƒë·ªìng ƒë·ªÅu  
- D·ªØ li·ªáu ƒë∆∞·ª£c s·ª≠ d·ª•ng th∆∞·ªùng xuy√™n v·∫´n ƒë∆∞·ª£c s·ª≠ d·ª•ng th∆∞·ªùng xuy√™n, d·ªØ li·ªáu kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng th∆∞·ªùng xuy√™n ti·∫øp t·ª•c ƒë∆∞·ª£c s·ª≠ d·ª•ng kh√¥ng th∆∞·ªùng xuy√™n  
	- => OS/CPU ‚Üí T·ª± ƒë·ªông ƒë·ªçc d·ªØ li·ªáu ƒë∆∞·ª£c s·ª≠ d·ª•ng th∆∞·ªùng xuy√™n ho·∫∑c c√≥ kh·∫£ nƒÉng ƒë∆∞·ª£c s·ª≠ d·ª•ng l·∫°i t·ª´ memory v√†o cache.  
- Do l∆∞·ª£ng d·ªØ li·ªáu th∆∞·ªùng xuy√™n s·ª≠ d·ª•ng nh·ªè so v·ªõi t·ªïng l∆∞·ª£ng d·ªØ li·ªáu n√™n b·ªô ƒë·ªám c√≥ th·ªÉ nh·ªè h∆°n b·ªô nh·ªõ v√† b·ªô nh·ªõ c√≥ th·ªÉ nh·ªè h∆°n ƒëƒ©a c·ª©ng.  

### 3. T√≠nh kh·∫£ thi v·ªÅ kinh t·∫ø  

- L·ªõp trong c·∫•u tr√∫c ph√¢n c·∫•p b·ªô nh·ªõ c√†ng cao th√¨ c√†ng ƒë·∫Øt.  
- Ph·∫ßn c·ª©ng ƒë·∫Øt ti·ªÅn ch·ªâ s·ª≠ d·ª•ng dung l∆∞·ª£ng l·ªõn th·ª±c s·ª± c·∫ßn thi·∫øt  
- S·ª≠ d·ª•ng ph·∫ßn c·ª©ng gi√° r·∫ª v·ªõi dung l∆∞·ª£ng l·ªõn
